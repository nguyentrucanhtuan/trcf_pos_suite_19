<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="trcf_kitchen_screen.KitchenDashboardTemplate">
        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet" />
        
        <!-- Tailwind Config -->
        <script>
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    darkMode: "class",
                    theme: {
                        extend: {
                            colors: {
                                "primary": "#28a745",
                                "primary-light": "#e9f6ec",
                                "background-light": "#f8f9fa",
                                "background-dark": "#102218",
                                "text-primary": "#1f2937",
                                "text-secondary": "#6b7280",
                                "border-color": "#e5e7eb",
                                "urgent": "#dc3545",
                                "urgent-light": "#fdebec",
                                "new": "#ffc107",
                                "new-light": "#fff8e6",
                            },
                            fontFamily: {
                                "display": ["Work Sans", "Noto Sans", "sans-serif"]
                            },
                        },
                    },
                }
            }
        </script>

        <!-- Custom Styles -->
        <style>
            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }
            .kitchen-body {
                font-family: 'Work Sans', 'Noto Sans', sans-serif;
                background-color: #f8f9fa;
                color: #1f2937;
                min-height: 100vh;
                height: 100vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            .line-completed .item-content {
                text-decoration: line-through;
                color: #6b7280;
            }
            
            /* Mobile scrolling - only scroll the main container */
            html, body {
                overflow: auto;
                -webkit-overflow-scrolling: touch;
            }
        </style>

        <div class="kitchen-body overflow-auto">
            <div class="relative flex w-full flex-col pb-4">
                <!-- Header -->
                <header class="sticky top-0 z-10 border-b border-gray-200 bg-gray-50/80 backdrop-blur-sm">
                    <div class="flex items-center justify-between p-4">
                        <div class="flex h-12 w-12 shrink-0 items-center justify-start">
                            <span class="text-3xl">üç≥</span>
                        </div>
                        <h1 class="flex-1 text-center text-2xl font-bold leading-tight tracking-tight text-gray-800">
                            <t t-esc="state.screen_name"/>
                        </h1>
                        <div class="flex items-center justify-end gap-4">
                            <!-- Toggle c√¥ng th·ª©c -->
                            <div class="flex items-center gap-2" t-on-click="() => this.toggleRecipe()">
                                <span class="cursor-pointer text-base font-medium text-gray-600">C√¥ng th·ª©c</span>
                                <div class="relative cursor-pointer">
                                    <div t-att-class="'h-6 w-11 rounded-full transition-colors ' + (state.showRecipe ? 'bg-green-500' : 'bg-gray-300')"></div>
                                    <div t-att-class="'absolute top-0.5 h-5 w-5 rounded-full bg-white shadow transition-all ' + (state.showRecipe ? 'left-[22px]' : 'left-0.5')"></div>
                                </div>
                            </div>
                            <span class="text-base font-medium text-gray-500">
                                <t t-esc="state.draft_count"/> ƒë∆°n
                            </span>
                        </div>
                    </div>
                </header>

                <!-- Main Content -->
                <main class="w-full p-2">
                    <!-- Orders Grid -->
                    <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
                        <t t-foreach="getOrdersByStatus('draft')" t-as="order" t-key="order.id">
                            <!-- ‚úÖ CH·ªà HI·ªÜN ƒê∆†N C√ì M√ìN -->
                            <t t-if="hasVisibleLines(order.id)">
                                <!-- Order Card -->
                                <div t-att-class="'flex flex-col rounded-xl bg-white shadow-md ' + getOrderBorderClass(order)">
                                    <div class="flex grow flex-col">
                                        <div class="flex grow flex-col gap-3 p-4">
                                            <!-- Order Header -->
                                            <div class="flex items-center justify-between gap-3">
                                                <p class="text-3xl font-bold leading-tight tracking-tight text-gray-800">
                                                    <t t-if="order.table_id">
                                                        <t t-esc="order.table_id[1]"/>
                                                    </t>
                                                    <t t-else="">
                                                        ƒê∆°n #<t t-esc="order.id"/>
                                                    </t>
                                                </p>
                                                <p t-att-class="'text-lg font-medium leading-normal ' + getTimeClass(order)">
                                                    <t t-esc="getRelativeTime(order.date_order)"/>
                                                </p>
                                            </div>

                                            <!-- Divider -->
                                            <div class="-mx-4 border-t border-gray-200"></div>

                                            <!-- Order Items -->
                                            <div class="flex flex-col divide-y divide-gray-200">
                                                <t t-foreach="getOrderLines(order.id)" t-as="line" t-key="line.id">
                                                    <div t-att-class="'relative py-3 ' + (line.trcf_order_status !== 'draft' ? 'line-completed' : '')">
                                                        <div class="flex flex-wrap items-center justify-between gap-x-4 gap-y-2">
                                                            <div class="item-content flex-1">
                                                                <p class="text-xl font-bold leading-normal text-gray-800">
                                                                    <t t-esc="line.qty"/>x <t t-esc="line.product_id[1]"/>
                                                                </p>
                                                                <t t-if="line.note">
                                                                    <p class="item-note text-base text-orange-600 font-medium">
                                                                        <t t-esc="line.note"/>
                                                                    </p>
                                                                </t>
                                                            </div>
                                                            <button 
                                                                t-on-click="() => this.markOrderLineReady(line.id)"
                                                                t-att-disabled="isOrderLineLoading(line.id) or line.trcf_order_status !== 'draft'"
                                                                t-att-class="'rounded-lg px-4 py-2 text-sm font-bold transition-colors disabled:cursor-not-allowed ' + (line.trcf_order_status !== 'draft' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300')">
                                                                <t t-if="isOrderLineLoading(line.id)">
                                                                    ‚è≥ ƒêang x·ª≠ l√Ω...
                                                                </t>
                                                                <t t-elif="line.trcf_order_status !== 'draft'">
                                                                    ‚úì ƒê√£ xong
                                                                </t>
                                                                <t t-else="">
                                                                    Xong
                                                                </t>
                                                            </button>
                                                        </div>

                                                        <t t-if="state.showRecipe and line.public_description">
                                                            <div
                                                                class="recipe-content mt-2 rounded-lg bg-blue-50 px-3 py-2 text-base text-blue-800">
                                                                <t t-out="renderHtml(line.public_description)"/>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Complete Button -->
                                    <div class="border-t border-gray-200 p-3">
                                        <button 
                                            t-on-click="() => this.markAsDone(order.id)"
                                            t-att-disabled="isOrderLoading(order.id)"
                                            class="w-full rounded-lg bg-green-600 py-4 text-lg font-bold text-white transition-colors hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                            <t t-if="isOrderLoading(order.id)">
                                                ‚è≥ ƒêang x·ª≠ l√Ω...
                                            </t>
                                            <t t-else="">
                                                ‚úì Ho√†n th√†nh
                                             </t>
                                        </button>
                                    </div>
                                </div>
                            </t>
                        </t>

                        <!-- Empty State -->
                        <t t-if="state.draft_count === 0">
                            <div class="col-span-full flex flex-col items-center justify-center py-20">
                                <span class="text-6xl">üìã</span>
                                <h3 class="mt-4 text-xl font-semibold text-gray-500">Kh√¥ng c√≥ ƒë∆°n h√†ng m·ªõi</h3>
                                <p class="mt-2 text-gray-400">T·∫•t c·∫£ ƒë∆°n h√†ng ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω</p>
                            </div>
                        </t>
                    </div>
                </main>
            </div>
        </div>
    </t>
</templates>